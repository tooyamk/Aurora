__set_project()
set(__OUTPUT_NAME_BASE astcenc-)
set(__OUTPUT_NAME_NONE ${__OUTPUT_NAME_BASE}none)
set(__OUTPUT_NAME_SSE2 ${__OUTPUT_NAME_BASE}sse2)
#set(__OUTPUT_NAME_SSE4 ${__OUTPUT_NAME_BASE}sse4)
#set(__OUTPUT_NAME_AVX2 ${__OUTPUT_NAME_BASE}avx2)
set(__OUTPUT_NAME_NEON ${__OUTPUT_NAME_BASE}neon)
set(LIB_PREFIX_NONE ${PROJECT_BINARY_DIR}/install/astcenc/${__OUTPUT_NAME_NONE})
set(LIB_PREFIX_SSE2 ${PROJECT_BINARY_DIR}/install/astcenc/${__OUTPUT_NAME_SSE2})
#set(LIB_PREFIX_SSE4 ${PROJECT_BINARY_DIR}/install/astcenc/${__OUTPUT_NAME_SSE4})
#set(LIB_PREFIX_AVX2 ${PROJECT_BINARY_DIR}/install/astcenc/${__OUTPUT_NAME_AVX2})
set(LIB_PREFIX_NEON ${PROJECT_BINARY_DIR}/install/astcenc/${__OUTPUT_NAME_NEON})
set(LIB_NONE_R ${LIB_PREFIX_NONE}${AE_LIB_SUFFIX})
set(LIB_NONE_D ${LIB_PREFIX_NONE}d${AE_LIB_SUFFIX})
set(LIB_SSE2_R ${LIB_PREFIX_SSE2}${AE_LIB_SUFFIX})
set(LIB_SSE2_D ${LIB_PREFIX_SSE2}d${AE_LIB_SUFFIX})
#set(LIB_SSE4_R ${LIB_PREFIX_SSE4}${AE_LIB_SUFFIX})
#set(LIB_SSE4_D ${LIB_PREFIX_SSE4}d${AE_LIB_SUFFIX})
#set(LIB_AVX2_R ${LIB_PREFIX_AVX2}${AE_LIB_SUFFIX})
#set(LIB_AVX2_D ${LIB_PREFIX_AVX2}d${AE_LIB_SUFFIX})
set(LIB_NEON_R ${LIB_PREFIX_NEON}${AE_LIB_SUFFIX})
set(LIB_NEON_D ${LIB_PREFIX_NEON}d${AE_LIB_SUFFIX})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_NAME ${PROJECT_NAME})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_INCLUDE ${PROJECT_BINARY_DIR}/src/Source)
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_NONE_LIB ${LIB_PREFIX_NONE}${AE_BUILD_TYPE_SUFFIX}${AE_LIB_SUFFIX})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_SSE2_LIB ${LIB_PREFIX_SSE2}${AE_BUILD_TYPE_SUFFIX}${AE_LIB_SUFFIX})
#set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_SSE4_LIB ${LIB_PREFIX_SSE4}${AE_BUILD_TYPE_SUFFIX}${AE_LIB_SUFFIX})
#set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_AVX2_LIB ${LIB_PREFIX_AVX2}${AE_BUILD_TYPE_SUFFIX}${AE_LIB_SUFFIX})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_NEON_LIB ${LIB_PREFIX_NEON}${AE_BUILD_TYPE_SUFFIX}${AE_LIB_SUFFIX})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_NONE_R ${LIB_NONE_R})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_NONE_D ${LIB_NONE_D})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_SSE2_R ${LIB_SSE2_R})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_SSE2_D ${LIB_SSE2_D})
#set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_SSE4_R ${LIB_SSE4_R})
#set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_SSE4_D ${LIB_SSE4_D})
#set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_AVX2_R ${LIB_AVX2_R})
#set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_AVX2_D ${LIB_AVX2_D})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_NEON_R ${LIB_NEON_R})
set_property(GLOBAL PROPERTY PROJECT_ASTC_ENCODER_LIB_NEON_D ${LIB_NEON_D})

include(ExternalProject)

__create_external_project_cmake_args(__CMAKE_ARGS)

string(TOLOWER ${CMAKE_SYSTEM_PROCESSOR} val)
if (val MATCHES "(amd)|(86)")
    set(ARGS
        -DISA_SSE2=ON
        -DISA_AVX2=OFF
        -DISA_SSE41=OFF
        -DISA_NEON=OFF
    )
elseif (val MATCHES "aarch64")
    set(ARGS
        -DISA_SSE2=OFF
        -DISA_AVX2=OFF
        -DISA_SSE41=OFF
        -DISA_NEON=ON
    )
endif ()

ExternalProject_Add(
    ${PROJECT_NAME}
    PREFIX ${PROJECT_BINARY_DIR}
    GIT_REPOSITORY https://github.com/ARM-software/astc-encoder.git
    GIT_TAG 2.2
    GIT_SHALLOW 1
    GIT_PROGRESS 1
    TMP_DIR tmp
    STAMP_DIR stamp
    DOWNLOAD_DIR download
    INSTALL_DIR install
    SOURCE_DIR src
    BINARY_DIR ${AE_BUILD_DIR}
    UPDATE_COMMAND ""
    PATCH_COMMAND
        ${CMAKE_COMMAND}
        -DGIT_ROOT=${PROJECT_BINARY_DIR}/src
        -DCMAKE_CORE_FILE=${CMAKE_CURRENT_BINARY_DIR}/src/Source/cmake_core.cmake
        -DSRC_DIR=${CMAKE_CURRENT_SOURCE_DIR}/src/
        -DDST_DIR=${CMAKE_CURRENT_BINARY_DIR}/src/
        -P ${CMAKE_CURRENT_SOURCE_DIR}/patch.cmake
    BUILD_BYPRODUCTS 
        ${LIB_NONE_R}
        ${LIB_NONE_D}
        ${LIB_SSE2_R}
        ${LIB_SSE2_D}
        ${LIB_NEON_R}
        ${LIB_NEON_D}
    CMAKE_ARGS
        -DISA_NONE=ON
        -DUNITTEST=OFF
        ${ARGS}
        ${__CMAKE_ARGS}
)

set_property(TARGET ${PROJECT_NAME} PROPERTY FOLDER ${AE_EXTERNAL_DIR_NAME})