__set_project()
set(__OUTPUT_NAME libpng16)
set_property(GLOBAL PROPERTY __PROJECT_LIBPNG_NAME ${PROJECT_NAME})
set_property(GLOBAL PROPERTY __PROJECT_LIBPNG_INCLUDE ${PROJECT_BINARY_DIR}/install/include)
set_property(GLOBAL PROPERTY __PROJECT_LIBPNG_LIB ${PROJECT_BINARY_DIR}/install/lib/${__OUTPUT_NAME}$<$<CONFIG:Debug>:d>${CMAKE_STATIC_LIBRARY_SUFFIX})
set_property(GLOBAL PROPERTY __PROJECT_LIBPNG_DLL ${PROJECT_BINARY_DIR}/install/bin/${__OUTPUT_NAME}$<$<CONFIG:Debug>:d>${CMAKE_SHARED_LIBRARY_SUFFIX})

get_property(__PROJECT_ZLIB_NAME GLOBAL PROPERTY "__PROJECT_ZLIB_NAME")
get_property(__PROJECT_ZLIB_INCLUDE GLOBAL PROPERTY "__PROJECT_ZLIB_INCLUDE")
get_property(__PROJECT_ZLIB_LIB GLOBAL PROPERTY "__PROJECT_ZLIB_LIB")

include(ExternalProject)

ExternalProject_Add(
    ${PROJECT_NAME}
    PREFIX ${PROJECT_BINARY_DIR}
    GIT_REPOSITORY https://github.com/glennrp/libpng.git
    GIT_TAG v1.6.37
    GIT_SHALLOW 1
    GIT_PROGRESS 1
    GIT_CONFIG core.autocrlf=false
    TMP_DIR tmp
    STAMP_DIR stamp
    DOWNLOAD_DIR download
    INSTALL_DIR install
    SOURCE_DIR src
    BINARY_DIR ${__BUILD_DIR}
    BUILD_BYPRODUCTS 
        ${PROJECT_BINARY_DIR}/install/lib/${__OUTPUT_NAME}${CMAKE_STATIC_LIBRARY_SUFFIX}
        ${PROJECT_BINARY_DIR}/install/lib/${__OUTPUT_NAME}d${CMAKE_STATIC_LIBRARY_SUFFIX}
    UPDATE_COMMAND ""
    CMAKE_ARGS
        -DPNG_BUILD_ZLIB=ON
        -DPNG_STATIC=OFF
        -DPNG_TESTS=OFF
        -DZLIB_INCLUDE_DIR=${__PROJECT_ZLIB_INCLUDE}
        -DZLIB_LIBRARY=${__PROJECT_ZLIB_LIB}
        -DCMAKE_INSTALL_PREFIX=<INSTALL_DIR>
)

add_dependencies(${PROJECT_NAME} ${__PROJECT_ZLIB_NAME})
set_property(TARGET ${PROJECT_NAME} PROPERTY FOLDER ${__AE_EXTERNAL_FOLDER_NAME})