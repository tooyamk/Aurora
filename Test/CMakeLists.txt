__set_project()

get_property(__PROJECT_AE_CORE_NAME GLOBAL PROPERTY "__PROJECT_AE_CORE_NAME")
get_property(__PROJECT_AE_CORE_SRC_DIR GLOBAL PROPERTY "__PROJECT_AE_CORE_SRC_DIR")
get_property(__PROJECT_AE_CORE_DLL GLOBAL PROPERTY "__PROJECT_AE_CORE_DLL")

get_property(__PROJECT_AE_WIN_GL_NAME GLOBAL PROPERTY "__PROJECT_AE_WIN_GL_NAME")
get_property(__PROJECT_AE_WIN_D3D11_NAME GLOBAL PROPERTY "__PROJECT_AE_WIN_D3D11_NAME")
get_property(__PROJECT_AE_WIN_DIRECT_INPUT_NAME GLOBAL PROPERTY "__PROJECT_AE_WIN_DIRECT_INPUT_NAME")
get_property(__PROJECT_AE_WIN_XINPUT_NAME GLOBAL PROPERTY "__PROJECT_AE_WIN_XINPUT_NAME")

get_property(__PROJECT_AE_PNG_CONVERTER_NAME GLOBAL PROPERTY "__PROJECT_AE_PNG_CONVERTER_NAME")
get_property(__PROJECT_AE_PNG_CONVERTER_OUTPUT_NAME GLOBAL PROPERTY "__PROJECT_AE_PNG_CONVERTER_OUTPUT_NAME")
get_property(__PROJECT_AE_PNG_CONVERTER_DLL GLOBAL PROPERTY "__PROJECT_AE_PNG_CONVERTER_DLL")

get_property(__PROJECT_AE_FBX_CONVERTER_NAME GLOBAL PROPERTY "__PROJECT_AE_FBX_CONVERTER_NAME")
get_property(__PROJECT_AE_FBX_CONVERTER_OUTPUT_NAME GLOBAL PROPERTY "__PROJECT_AE_FBX_CONVERTER_OUTPUT_NAME")
get_property(__PROJECT_AE_FBX_CONVERTER_DLL GLOBAL PROPERTY "__PROJECT_AE_FBX_CONVERTER_DLL")

get_property(__PROJECT_AE_PST_NAME GLOBAL PROPERTY "__PROJECT_AE_PST_NAME")
get_property(__PROJECT_AE_PST_DLL GLOBAL PROPERTY "__PROJECT_AE_PST_DLL")

get_property(__PROJECT_ZLIB_DLL GLOBAL PROPERTY "__PROJECT_ZLIB_DLL")
get_property(__PROJECT_LIBPNG_DLL GLOBAL PROPERTY "__PROJECT_LIBPNG_DLL")
get_property(__PROJECT_GLEW_DLL GLOBAL PROPERTY "__PROJECT_GLEW_DLL")
get_property(__PROJECT_DX_SHADER_COMPILER_DLL GLOBAL PROPERTY "__PROJECT_DX_SHADER_COMPILER_DLL")

if (WIN32)
    get_property(__PROJECT_AE_WIN_GL_DLL GLOBAL PROPERTY "__PROJECT_AE_WIN_GL_DLL")
    get_property(__PROJECT_AE_WIN_D3D11_DLL GLOBAL PROPERTY "__PROJECT_AE_WIN_D3D11_DLL")
    get_property(__PROJECT_AE_WIN_DIRECT_INPUT_DLL GLOBAL PROPERTY "__PROJECT_AE_WIN_DIRECT_INPUT_DLL")
    get_property(__PROJECT_AE_WIN_XINPUT_DLL GLOBAL PROPERTY "__PROJECT_AE_WIN_XINPUT_DLL")
endif ()

include_directories(
    ${__PROJECT_AE_CORE_SRC_DIR}/src/
    ${__AE_ROOT_FOLDER}/
)
file(GLOB SRC_FILES "src/*.h" "src/*.cpp" "src/*/*.h" "src/*/*.cpp")
__add_executable_source_group(${PROJECT_NAME} ${SRC_FILES})

target_link_libraries(${PROJECT_NAME}
    ${__PROJECT_AE_CORE_NAME}
    ${__PROJECT_AE_PNG_CONVERTER_NAME}
    ${__PROJECT_AE_FBX_CONVERTER_NAME}
)

if (WIN32)
    macro(__set_delayload)
        set(CMAKE_EXE_LINKER_FLAGS_DEBUG "${CMAKE_EXE_LINKER_FLAGS_DEBUG} /DELAYLOAD:${ARGV0}${CMAKE_DEBUG_POSTFIX}${CMAKE_SHARED_LIBRARY_SUFFIX}")
        set(CMAKE_EXE_LINKER_FLAGS_RELEASE "${CMAKE_EXE_LINKER_FLAGS_RELEASE} /DELAYLOAD:${ARGV0}${CMAKE_RELEASE_POSTFIX}${CMAKE_SHARED_LIBRARY_SUFFIX}")
        set(CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO "${CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO} /DELAYLOAD:${ARGV0}${CMAKE_RELWITHDEBINFO_POSTFIX}${CMAKE_SHARED_LIBRARY_SUFFIX}")
        set(CMAKE_EXE_LINKER_FLAGS_MINSIZEREL "${CMAKE_EXE_LINKER_FLAGS_MINSIZEREL} /DELAYLOAD:${ARGV0}${CMAKE_MINSIZEREL_POSTFIX}${CMAKE_SHARED_LIBRARY_SUFFIX}")
    endmacro(__set_delayload)

    set_target_properties(${PROJECT_NAME} PROPERTIES LINK_FLAGS /SUBSYSTEM:WINDOWS)
    __set_delayload(${__PROJECT_AE_PNG_CONVERTER_OUTPUT_NAME})
    __set_delayload(${__PROJECT_AE_FBX_CONVERTER_OUTPUT_NAME})
endif ()

set(__OUTPUT_LIBS_FOLDER ${__BUILD_DIR}/libs)

add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E make_directory ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E create_symlink ${CMAKE_CURRENT_SOURCE_DIR}/../Resources/ ${__BUILD_DIR}/Resources/ 
)

add_custom_target(run_test_general ALL
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_CORE_DLL} ${__BUILD_DIR}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_PNG_CONVERTER_DLL} ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_FBX_CONVERTER_DLL} ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_ZLIB_DLL} ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_LIBPNG_DLL} ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_GLEW_DLL} ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_DX_SHADER_COMPILER_DLL} ${__OUTPUT_LIBS_FOLDER}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_PST_DLL} ${__OUTPUT_LIBS_FOLDER}
)
add_dependencies(run_test_general
    ${__PROJECT_AE_CORE_NAME}
    ${__PROJECT_AE_PNG_CONVERTER_NAME}
    ${__PROJECT_AE_FBX_CONVERTER_NAME}
    ${__PROJECT_AE_PST_NAME}
)
add_dependencies(${PROJECT_NAME} run_test_general)
if (WIN32)
    add_custom_target(run_test_win ALL
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_WIN_GL_DLL} ${__OUTPUT_LIBS_FOLDER}
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_WIN_D3D11_DLL} ${__OUTPUT_LIBS_FOLDER}
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_WIN_DIRECT_INPUT_DLL} ${__OUTPUT_LIBS_FOLDER}
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${__PROJECT_AE_WIN_XINPUT_DLL} ${__OUTPUT_LIBS_FOLDER}
    )
    add_dependencies(run_test_win
        ${__PROJECT_AE_WIN_GL_NAME}
        ${__PROJECT_AE_WIN_D3D11_NAME}
        ${__PROJECT_AE_WIN_DIRECT_INPUT_NAME}
        ${__PROJECT_AE_WIN_XINPUT_NAME}
    )
    add_dependencies(${PROJECT_NAME} run_test_win)
endif ()